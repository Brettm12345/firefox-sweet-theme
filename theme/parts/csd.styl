/* GNOME CSD styles for headerbar on Firefox [tabsintitlebar] */
@namespace xul 'http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul'

#main-window {
  ap -moz-window-titlebar
}

:root[tabsintitlebar] {
  /* Fullscreen headerbar padding for 1 button */
  &[inFullscreen] #nav-bar {
    pr 50px
  }

  /* Headerbar top border corners rounded */
  &:not([inFullScreen]):not([inFullscreen]):not([sizemode='maximized']) #nav-bar {
    r 7px 7px 0 0
  }

  &:not([inFullscreen]) #nav-bar {
    /* Window buttons: at least 1 button */
    @media (-moz-gtk-csd-minimize-button: ), (-moz-gtk-csd-maximize-button: ), (-moz-gtk-csd-close-button: ) {
      pr 50px
    }

    /* Window buttons: at least 2 buttons */
    @media (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-maximize-button: ), (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-close-button: ), (-moz-gtk-csd-maximize-button: ) and (-moz-gtk-csd-close-button: ) {
      pr 90px
    }

    /* Window buttons: 3 buttons */
    @media (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-maximize-button: ) and (-moz-gtk-csd-close-button: ) {
      pr 130px
    }
  }

  /* Window buttons box */
  #titlebar .titlebar-buttonbox-container, #titlebar-buttonbox-container, &[inFullscreen] #window-controls {
    top 0
    right 0
    p 0 3px 0 4px
    ps absolute
    ap none
  }

  #titlebar, #titlebar {
    .titlebar-buttonbox {
      ap none
    }

    /* Window buttons style */
    .titlebar-button, :root[tabsintitlebar] #window-controls toolbarbutton {
      c 0 transparent
      r 5px
      m -8px -2px
      p 0 2px
      s 30
      b 1px solid v(button-border-color)

      .toolbarbutton-icon {
        w 16px
      }
    }

    &:-moz-window-inactive .titlebar-button .toolbarbutton-icon, :root[tabsintitlebar][inFullscreen] #window-controls:-moz-window-inactive toolbarbutton .toolbarbutton-icon {
      o 0.5
    }

    &:not(:-moz-window-inactive) .titlebar-button:not([disabled]) {
      &:hover, :root[tabsintitlebar][inFullscreen] #window-controls:not(:-moz-window-inactive) toolbarbutton:not([disabled]):hover {
        border-bottom-color v(button-border-accent-color) i
        background-image v(button-hover-background)
        bc v(button-border-color)
        bs v(button-box-shadow)
      }

      &:active, :root[tabsintitlebar][inFullscreen] #window-controls:not(:-moz-window-inactive) toolbarbutton:not([disabled]):active {
        bc v(button-active-border-color)
        bg v(button-active-background)
        bs v(button-active-box-shadow)
      }
    }
  }
}

/* Remove close and minimize buttons from fullscreen buttons */
:root[tabsintitlebar][inFullscreen] #window-controls #close-button, :root[tabsintitlebar][inFullscreen] #window-controls #minimize-button {
  display none
}

/* Left window buttons */
@media (-moz-gtk-csd-reversed-placement: ) {
  :root[tabsintitlebar]:not([inFullscreen]) #nav-bar {
    pr 3px
  }

  /* Window buttons box */
  :root[tabsintitlebar] #titlebar .titlebar-buttonbox-container {
    right auto
    left 0
    p 0 3px 0 4px
  }

  /* Window controls: at least 1 button */
  @media (-moz-gtk-csd-minimize-button: ), (-moz-gtk-csd-maximize-button: ), (-moz-gtk-csd-close-button: ) {
    :root[tabsintitlebar]:not([inFullscreen]) #nav-bar {
      pl 50px
    }
  }

  /* Window controls: at least 2 buttons */
  @media (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-maximize-button: ), (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-close-button: ), (-moz-gtk-csd-maximize-button: ) and (-moz-gtk-csd-close-button: ) {
    :root[tabsintitlebar]:not([inFullscreen]) #nav-bar {
      pl 90px
    }
  }

  /* Window controls: 3 buttons */
  @media (-moz-gtk-csd-minimize-button: ) and (-moz-gtk-csd-maximize-button: ) and (-moz-gtk-csd-close-button: ) {
    :root[tabsintitlebar]:not([inFullscreen]) #nav-bar {
      pl 90px
    }
  }
}

/* Remove tabsbar titlebar blank spaces */
:root[tabsintitlebar] #TabsToolbar .titlebar-placeholder {
  display none i
}

/* Prevent menubar from breaking */
:root[tabsintitlebar] #toolbar-menubar:not([inactive=true]) {
  mb 8px
  h 30px
}

/* Remove default style of titlebar */
:root[tabsintitlebar] #titlebar {
  ap none
}

/* Fix the issue when dragging tabs */
:root[tabsintitlebar] #navigator-toolbox[movingtab] #TabsToolbar {
  pb 0
}

/* Allow window drag with headerbar buttons */
:root[tabsintitlebar] #nav-bar *, :root[tabsintitlebar] #titlebar .titlebar-button, :root[tabsintitlebar][inFullscreen] #window-controls toolbarbutton {
  -moz-window-dragging drag
}

:root[tabsintitlebar] #nav-bar .urlbar-input-box, :root[tabsintitlebar] #nav-bar .urlbar-input-box *, #back-button, #forward-button {
  -moz-window-dragging no-drag i
}

/* FF 60 fixes */
:root[tabsintitlebar] {
  #titlebar[style="margin-bottom: -1px;"] {
    mb -38px
  }

  #titlebar-content {
    position absolute
    top 0 i
    display block i
    h 38px
  }

  #titlebar-buttonbox {
    m 0
    p 0
    h auto
  }

  #titlebar-content .titlebar-button {
    p 0 7px
  }
}
